## 9 线程控制














### 9.8 线程和信号

即使在基于进程的编程范型中，信号处理有时候也是很复杂的。把线程引入编程范型，就使信号处理变得更加复杂。

每个线程都有自己的信号屏蔽字，但是信号的处理是进程中所有线程共享的。这意味着单个线程可以阻止某些信号，但是当某个线程修改了与某个给定信号的处理行为以后，所有的线程都必须共享这个处理行为的改变。这样，如果一个线程选择忽略某个给定信号，那么另一个线程就可以通过以下两种方式撤销上述线程的信号选择：恢复信号的默认处理行为，或者为信号设置一个新的信号处理程序。

进程中信号是递送到单个线程的。如果一个信号与硬件故障先关，那么该信号一般会被发送到引起该事件的线程中去，而其他信号则被发送到任意一个线程。

在信号章节中我们讨论了如何使用sigprocmask函数来阻止信号发送。然而，sigprocmask的行为在多线程中并没有定义，线程必须使用pthread_sigmask。

```c
    int pthread_sigmask(int how, const sigset_t *set, sigset_t *oldset);
    //Compile and link with -pthread
    //返回值：若成功，返回0；否则，返回错误编号
```